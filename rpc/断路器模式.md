# 断路器模式

## https://docs.microsoft.com/en-us/previous-versions/msp-n-p/dn589784(v=pandp.10)?redirectedfrom=MSDN

## github.com/sony/gobreaker

![](/Users/libinbin/Downloads/lbbNote/rpc/duanluqi.png)



closed： 正常模式

    参数 interval ，清理正常模式下的记录数据的时间间隔

     参数 readyToTrip 控制正常模式转到open模式

open: 断路模式，来自应用程序的请求立即失败，并向应用程序返回异常

    参数 timeout , open模式多长时间后转换为half-open模式

half-open: **半开放** ：允许来自应用程序的有限数量的请求通过并调用操作。

    参数 maxRequest, 半开放模式下正常请求连续达到maxRequest后转为closed



## 流程

2. 获取当前的状态(如果是closed状态看interval定时是否触发，如果是open状态，看timeout定时是否触发)

3. 如果当前状态是open， 直接返回，如果是half-open , 判断maxRequest是否触发，触发就直接返回

4. 执行函数

5. 再次执行获取当前状态函数，如果状态变化过，则退出，否侧根据函数返回的错误，执行计数操作，和状态变化函数。
